
# 硬盘基本概念
- MBR(master boot record)传统的分区机制，应用于绝大多数使用BIOS的PC机
    - 支持32bit和64bit
    - 分区数量有限
    - 只支持不超过2T的硬盘，多于2T只能使用2T
    - 分区
        - 4个主分区
        - 扩展分区(占用一个主分区)
        - 逻辑分区(在扩展分区上分)

- GPT(GUID partition table)
    - 支持超过2t的硬盘
    - 向后兼容MBR
    - 必须支持UEFI的硬件才可使用
    - 必须使用64bit系统
    - Mac和Linux系统支持
    - win7 64bit和win server 2008 64bit支持

# FDISK linux自带的分区工具
- 只有具有超级用户权限才能够运行
- `fdisk -l` 列出所有安装的磁盘及其分区信息
- `fdisk /dev/***`可以对目标磁盘进行分区操作
    - `m`查看命令
    - `p`查看磁盘数据
    - `n`创建新分区
    - `w`写入磁盘操作
- 需要用`partprobe`命令让内核更新分区信息，否则需要`reboot`
- /proc/partitions 文件可以查看分区信息

# 文件系统
- 刚刚分区好的磁盘为裸(raw)设备
- `mke2fs -t ext4 /dev/sda1` 创建文件系统
    - `-b blocksize` 指定文件系统块大小为blocksize
    - `-c` 建立文件系统时检查坏损块
    - `-L label` 指定卷标为label
    - `-j` 建立文件系统日志(ex3,ex4自带)
- `mkfs`
    - table下有很多子项，直接使用即可，不能进行精细化控制
- `dumpe2fs /dev/sda1` 查看分区的文件系统信息
- journal日志
    - 使用带日志的文件系统，该系统会使用“两阶段提交”的方式进行磁盘操作，当进行磁盘操作时，文件系统进行以下操作：
    (1) 文件系统将准备的事务的具体内容写入日志
    (2) 文件系统进行操作
    (3) 操作成功后，将事务的具体内容从日志中删除
    - 好处： 当事务执行的时候如果出现意外(比如断电后磁盘故障)，可以通过查询日志进行恢复操作。缺点是会丧失性能(额外的日志读写操作)
- e2label 为文件系统添加标签
    - `e2label /dev/sda1` 显示sda1的系统标签
    - `e2label /dev/sda2 SYSTEMINFO`将sda2的系统标签设置为SYSTENINFO
- `fsck /dev/sda1` 检查并且修复损坏的文件系统
    - `-y`不提示而直接进行修复
    - 默认fsck会自佛呢判断文件系统类型，如果文件系统损坏较为严重，则使用`-t filesystem`指定文件系统类型
    - 识别为文件的损坏数据(文件系统中无记录)，fsck会将该文件放入`lost+found`目录
    - 系统启动时会对磁盘进行fsck操作

# 挂载操作
- 磁盘或者分区创建好文件系统后，需要挂载到一个目录才能够使用
	- linux需要手工进行挂载操作或者配置系统进行自动挂载
- MOUNT
    - 将格式化好的磁盘或分区挂载到一个目录上
    - `mount /dev/sdb1(需要挂载的分区) /mnt(挂载点)`
    - 参数
        - default： 默认显示所有已挂载的文件系统
        - `-t` 指定文件系统的类型
        - `-o` 指定挂载选项
            - `ro, rw` 只读/读写，默认读写
            - `sync` 不使用缓存，直接写入操作，需要数据安全时使用
            - `async` 使用缓存，默认项
            - `noatime` 访问文件时不更新文件的访问时间
            - `atime` 访问文件时更新文件的访问时间
            - `remount` 重新挂载文件系统
            - **`,`** 对挂载选项或操作
- UMOUNT
    - 卸载已挂载的文件系统，**在更新文件系统的配置时记得UMOUNT**
    - `umont 文件系统or挂载点`
    - 如果出现 `device is busy`报错
        - `fuser -m 挂载点` 查看文件系统的进程
        - `lsof 挂载点` 查看正在被使用的文件
- **自动挂载**
    - `/etc/fstab` 该配置文件用来定义需要自动挂载的文件系统。每一行代表一个挂载配置，格式如下
    - `需要挂载的设备	挂载点	文件系统	挂载选项(MOUNT选项里的-o挂载选项，默认default)	0 0(dump、fsck相关选项)`
    - 其中`需要挂载的设备`也可以使用`LABEL`进行识别，使用`LABEL=TESTLABEL`取代某一个文件系统(`LABEL`使用`e2label 挂载设备 描述`)
    - `mount -a`命令会挂载所有fstab中定义的自动挂载项